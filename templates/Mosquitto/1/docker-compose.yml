version: '2'
services:
  # config:
  #   image: lsquared/mosquitto-config:latest
  #   volumes:
  #     - broker-config:/mosquitto/config
  #     - proxy-config:/nginx/config

  broker:
    image: lsquared/mosquitto:1.4.14
    labels:
      io.rancher.container.pull_image: always
    networks:
    - mosquitto
    ports:
    {{- if (.Values.MQTT_PORT) }}
      - ${MQTT_PORT}:1883
    {{- end }}
    {{- if (.Values.MQTT_SSL_PORT) }}
      - ${MQTT_SSL_PORT}:8883
    {{- end }}
    {{- if (.Values.MQTT_WSS_PORT) }}
      - ${MQTT_WSS_PORT}:9883
    {{- end }}
    restart: always
    volumes:
      - broker-config:/srv/mosquitto/config:ro
      - broker-data:/srv/mosquitto/data

  # proxy:
  #   environment:
  #   - VIRTUAL_HOST:mqtt.lsquared.fr
  #   image: lsquared/nginx:X.X.X
  #   restart: always
  #   volumes:
  #     - proxy-config:/etc/nginx/:ro

volumes:
  broker-config:
  broker-data:
  # proxy-config:

network:
  mosquitto:
